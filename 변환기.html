<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë‚˜ë§Œì˜ í•œê¸€ â†” ì½”ë“œ ë³€í™˜ê¸° (ì™„ì„±ë³¸)</title>
    <style>
        /* CSS ìŠ¤íƒ€ì¼ì€ ì´ì „ê³¼ ë™ì¼í•˜ë¯€ë¡œ ìƒëµí•˜ì§€ ì•Šê³  ëª¨ë‘ í¬í•¨í•©ë‹ˆë‹¤. */
        body { font-family: 'Malgun Gothic', sans-serif; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; margin: 0; background-color: #f0f2f5; }
        .container { width: 90%; max-width: 1200px; display: flex; gap: 20px; }
        .main-box { flex: 3; display: flex; gap: 20px; }
        .rules-box { flex: 1; display: flex; flex-direction: column; }
        .box { flex: 1; display: flex; flex-direction: column; }
        h2 { margin-top: 0; margin-bottom: 10px; text-align: center; color: #333; }
        textarea { width: 100%; height: 300px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; resize: vertical; box-sizing: border-box; }
        #rulesTextarea { height: 570px; font-family: monospace; font-size: 14px; }
        .controls { display: flex; gap: 10px; margin-top: 10px; align-items: center; }
        .char-count { font-size: 14px; color: #666; margin-left: auto; }
        button { padding: 8px 15px; border: none; border-radius: 4px; background-color: #007bff; color: white; font-size: 14px; cursor: pointer; transition: background-color 0.2s; }
        button:hover { background-color: #0056b3; }
        button.clear { background-color: #dc3545; }
        button.clear:hover { background-color: #c82333; }
        .warning { margin-top: 20px; font-size: 14px; color: #d93025; text-align: center; font-weight: bold; }
    </style>
</head>
<body>

<h1>ë‚˜ë§Œì˜ í•œê¸€ â†” ì½”ë“œ ë³€í™˜ê¸° (ì™„ì„±ë³¸)</h1>

<div class="container">
    <div class="main-box" style="display: flex; gap: 20px;">
        <div class="box">
            <h2>í•œê¸€ ì…ë ¥</h2>
            <textarea id="koreanInput" placeholder="í•œê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            <div class="controls">
                <button id="copyKoreanBtn">í•œê¸€ ë³µì‚¬</button>
                <div id="koreanCharCount" class="char-count">0ì</div>
            </div>
        </div>
        <div class="box">
            <h2>ì½”ë“œ ë³€í™˜</h2>
            <textarea id="codeInput" placeholder="ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            <div class="controls">
                <button id="copyCodeBtn">ì½”ë“œ ë³µì‚¬</button>
                <div id="codeCharCount" class="char-count">0ì</div>
            </div>
        </div>
    </div>
    <div class="rules-box">
        <h2>ë³€í™˜ ê·œì¹™ (ìëª¨:ì½”ë“œ)</h2>
        <textarea id="rulesTextarea"></textarea>
        <div class="controls">
             <button id="applyRulesBtn">ê·œì¹™ ì ìš©</button>
             <button id="clearAllBtn" class="clear">ì „ì²´ ì‚­ì œ</button>
        </div>
    </div>
</div>

<div class="warning">
    âš ï¸ ì´ ë„êµ¬ëŠ” ê·œì¹™ í…ŒìŠ¤íŠ¸ ë° êµìœ¡ìš©ì…ë‹ˆë‹¤. ì‹¤ì œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì €ì¥í•˜ê±°ë‚˜ ê´€ë¦¬í•˜ëŠ” ìš©ë„ë¡œ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.
</div>

<script>
    // --- ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° (ì´ì „ê³¼ ë™ì¼) ---
    const koreanTextarea = document.getElementById('koreanInput');
    const codeTextarea = document.getElementById('codeInput');
    const rulesTextarea = document.getElementById('rulesTextarea');
    const applyRulesBtn = document.getElementById('applyRulesBtn');
    const copyKoreanBtn = document.getElementById('copyKoreanBtn');
    const copyCodeBtn = document.getElementById('copyCodeBtn');
    const clearAllBtn = document.getElementById('clearAllBtn');
    const koreanCharCount = document.getElementById('koreanCharCount');
    const codeCharCount = document.getElementById('codeCharCount');

    // --- ë³€ìˆ˜ ë° í•œê¸€ ìëª¨ ìƒìˆ˜ ---
    let korToEng = {};
    let engToKor = {};

    const KOREAN_START_CODE = 44032;
    const CHOSEONG = ['ã„±','ã„²','ã„´','ã„·','ã„¸','ã„¹','ã…','ã…‚','ã…ƒ','ã……','ã…†','ã…‡','ã…ˆ','ã…‰','ã…Š','ã…‹','ã…Œ','ã…','ã…'];
    const JUNGSEONG = ['ã…','ã…','ã…‘','ã…’','ã…“','ã…”','ã…•','ã…–','ã…—','ã…˜','ã…™','ã…š','ã…›','ã…œ','ã…','ã…','ã…Ÿ','ã… ','ã…¡','ã…¢','ã…£'];
    const JONGSEONG = ['', 'ã„±','ã„²','ã„³','ã„´','ã„µ','ã„¶','ã„·','ã„¹','ã„º','ã„»','ã„¼','ã„½','ã„¾','ã„¿','ã…€','ã…','ã…‚','ã…„','ã……','ã…†','ã…‡','ã…ˆ','ã…Š','ã…‹','ã…Œ','ã…','ã…'];

    const JUNGSEONG_COMBINATIONS = { 'ã…—ã…':'ã…˜', 'ã…—ã…':'ã…™', 'ã…—ã…£':'ã…š', 'ã…œã…“':'ã…', 'ã…œã…”':'ã…', 'ã…œã…£':'ã…Ÿ', 'ã…¡ã…£':'ã…¢' };
    const JONGSEONG_COMBINATIONS = { 'ã„±ã……':'ã„³', 'ã„´ã…ˆ':'ã„µ', 'ã„´ã…':'ã„¶', 'ã„¹ã„±':'ã„º', 'ã„¹ã…':'ã„»', 'ã„¹ã…‚':'ã„¼', 'ã„¹ã……':'ã„½', 'ã„¹ã…Œ':'ã„¾', 'ã„¹ã…':'ã„¿', 'ã„¹ã…':'ã…€', 'ã…‚ã……':'ã…„' };

    // --- í•µì‹¬ í•¨ìˆ˜ ---
    function parseAndApplyRules() {
        korToEng = {};
        engToKor = {};
        const rules = rulesTextarea.value.split('\n');
        rules.forEach(line => {
            if (line.startsWith('#')) return; // ì£¼ì„ ì²˜ë¦¬
            const parts = line.split(':');
            if (parts.length === 2) {
                const kor = parts[0].trim();
                const eng = parts[1].trim();
                if (kor && eng) {
                    korToEng[kor] = eng;
                    engToKor[eng] = kor;
                }
            }
        });
        updateConversion(true);
    }

    function convertToCode(koreanText) {
        let result = "";
        for (const char of koreanText) {
            const charCode = char.charCodeAt(0);
            if (charCode >= KOREAN_START_CODE && charCode <= 55203) {
                const baseCode = charCode - KOREAN_START_CODE;
                const jongseongIndex = baseCode % 28;
                const jungseongIndex = ((baseCode - jongseongIndex) / 28) % 21;
                const choseongIndex = Math.floor(((baseCode - jongseongIndex) / 28) / 21);
                result += korToEng[CHOSEONG[choseongIndex]] || CHOSEONG[choseongIndex];
                result += korToEng[JUNGSEONG[jungseongIndex]] || JUNGSEONG[jungseongIndex];
                if (jongseongIndex > 0) result += korToEng[JONGSEONG[jongseongIndex]] || JONGSEONG[jongseongIndex];
            } else {
                result += korToEng[char] || char;
            }
        }
        return result;
    }
    
    // [ìµœì¢…] ì½”ë“œ -> í•œê¸€ ì¡°í•© í•¨ìˆ˜
    function convertToKorean(codeText) {
        let jamoStream = [];
        const sortedCodes = Object.keys(engToKor).sort((a, b) => b.length - a.length);
        let i = 0;
        while (i < codeText.length) {
            let found = false;
            for (const code of sortedCodes) {
                if (codeText.substring(i, i + code.length) === code) {
                    jamoStream.push(engToKor[code]);
                    i += code.length;
                    found = true;
                    break;
                }
            }
            if (!found) {
                jamoStream.push(codeText[i]);
                i++;
            }
        }

        let result = "";
        let buffer = []; // [ì´ˆì„±, ì¤‘ì„±, ì¢…ì„±]
        
        const commitSyllable = () => {
            if (buffer.length === 0) return;
            const [ch, ju, jo] = buffer;
            if (!ju) { // ì¤‘ì„±ì´ ì—†ëŠ” ê²½ìš° (ììŒë§Œ ì…ë ¥)
                result += ch;
                return;
            }
            const chIndex = CHOSEONG.indexOf(ch);
            const juIndex = JUNGSEONG.indexOf(ju);
            const joIndex = jo ? JONGSEONG.indexOf(jo) : 0;
            const charCode = KOREAN_START_CODE + (chIndex * 21 * 28) + (juIndex * 28) + joIndex;
            result += String.fromCharCode(charCode);
            buffer = [];
        };

        for (const jamo of jamoStream) {
            if (buffer.length === 0) { // ìƒˆ ê¸€ì ì‹œì‘
                if (CHOSEONG.includes(jamo)) buffer.push(jamo);
                else result += jamo;
            } else if (buffer.length === 1) { // ì´ˆì„±ë§Œ ìˆëŠ” ìƒíƒœ
                const [ch] = buffer;
                if (JUNGSEONG.includes(jamo)) buffer.push(jamo);
                else {
                    commitSyllable();
                    if (CHOSEONG.includes(jamo)) buffer.push(jamo);
                    else result += jamo;
                }
            } else if (buffer.length === 2) { // ì´ˆì„±+ì¤‘ì„± ìƒíƒœ
                const [ch, ju] = buffer;
                const combinedJung = JUNGSEONG_COMBINATIONS[ju + jamo];
                if (combinedJung) {
                    buffer[1] = combinedJung; // ê²¹ëª¨ìŒìœ¼ë¡œ í•©ì¹˜ê¸°
                } else if (JONGSEONG.includes(jamo)) {
                    buffer.push(jamo); // ë°›ì¹¨ìœ¼ë¡œ ì¶”ê°€
                } else {
                    commitSyllable();
                    if (CHOSEONG.includes(jamo)) buffer.push(jamo);
                    else result += jamo;
                }
            } else if (buffer.length === 3) { // ì´ˆì„±+ì¤‘ì„±+ì¢…ì„± ìƒíƒœ
                const [ch, ju, jo] = buffer;
                const combinedJong = JONGSEONG_COMBINATIONS[jo + jamo];
                if (combinedJong && JONGSEONG.includes(combinedJong)) {
                    buffer[2] = combinedJong; // ê²¹ë°›ì¹¨ìœ¼ë¡œ í•©ì¹˜ê¸°
                } else if (JUNGSEONG.includes(jamo)) { // ë‹¤ìŒ ê¸€ìê°€ ëª¨ìŒìœ¼ë¡œ ì‹œì‘ (ì—°ìŒ)
                    const lastJong = buffer.pop();
                    commitSyllable();
                    buffer.push(lastJong, jamo); // ìƒˆ ê¸€ìì˜ ì´ˆì„±, ì¤‘ì„±ìœ¼ë¡œ
                } else {
                    commitSyllable();
                    if (CHOSEONG.includes(jamo)) buffer.push(jamo);
                    else result += jamo;
                }
            }
        }
        commitSyllable(); // ë§ˆì§€ë§‰ì— ë²„í¼ì— ë‚¨ì€ ê¸€ì ì²˜ë¦¬
        return result;
    }

    // --- ë‚˜ë¨¸ì§€ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ì´ì „ê³¼ ë™ì¼) ---
    function updateCharCounts() {
        koreanCharCount.textContent = `${koreanTextarea.value.length}ì`;
        codeCharCount.textContent = `${codeTextarea.value.length}ì`;
    }
    function updateConversion(isKoreanToCode) {
        if (isKoreanToCode) {
            codeTextarea.value = convertToCode(koreanTextarea.value);
        } else {
            koreanTextarea.value = convertToKorean(codeTextarea.value);
        }
        updateCharCounts();
    }
    koreanTextarea.addEventListener('input', () => updateConversion(true));
    codeInput.addEventListener('input', () => updateConversion(false));
    applyRulesBtn.addEventListener('click', parseAndApplyRules);
    clearAllBtn.addEventListener('click', () => {
        koreanTextarea.value = ''; codeTextarea.value = ''; updateCharCounts();
    });
    copyKoreanBtn.addEventListener('click', () => navigator.clipboard.writeText(koreanTextarea.value).then(() => alert('í•œê¸€ ë‚´ìš©ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.')));
    copyCodeBtn.addEventListener('click', () => navigator.clipboard.writeText(codeTextarea.value).then(() => alert('ì½”ë“œ ë‚´ìš©ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.')));
    
    // --- ì´ˆê¸°í™” ---
    function initialize() {
        const defaultRules = `# --- ììŒ ê·œì¹™ ---
ã„±:ê·¸
ã„²:ê¸°
ã„´:ëŠ
ã„·:ë“œ
ã„¸:ë””
ã„¹:ë¥´
ã…:ë¯€
ã…‚:ë¸Œ
ã…ƒ:ë¹„
ã……:ìŠ¤
ã…†:ì‹œ
ã…‡:ìœ¼
ã…ˆ:ì¦ˆ
ã…‰:ì§€
ã…Š:ì¸ 
ã…‹:í¬
ã…Œ:íŠ¸
ã…:í”„
ã…:í

# --- ê²¹ë°›ì¹¨ ê·œì¹™ ---
ã„³:ê·¸ìŠ¤
ã„µ:ëŠì¦ˆ
ã„¶:ëŠí
ã„º:ë¥´ê·¸
ã„»:ë¥´ë¯€
ã„¼:ë¥´ë¸Œ
ã„½:ë¥´ìŠ¤
ã„¾:ë¥´íŠ¸
ã„¿:ë¥´í”„
ã…€:ë¥´í
ã…„:ë¸ŒìŠ¤


# --- ëª¨ìŒ ê·œì¹™ ---
ã…:1
ã…:10
ã…‘:â¤
ã…’:â¤0
ã…“:ğŸ€
ã…”:ğŸ€0
ã…•:4
ã…–:40
ã…—:Î´
ã…˜:Î´1
ã…™:Î´10
ã…š:Î´0
ã…›:6
ã…œ:Í²
ã…:Í²ğŸ€
ã…:Í²ğŸ€0
ã…Ÿ:Í²0
ã… :8
ã…¡:9
ã…¢:90
ã…£:0`;
        rulesTextarea.value = defaultRules.split('\n').filter(line => line.trim() !== '').join('\n'); // ë¶ˆí•„ìš”í•œ ê³µë°± ë¼ì¸ ì œê±°
        parseAndApplyRules();
    }
    initialize();
</script>

</body>
</html>
